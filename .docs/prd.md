# **PRD：多-Agent 智能数据分析与报表生成系统**

## 1. 产品概述

### 1.1 产品目标

构建一个基于多 Agent 协作的智能数据分析系统，自动完成从 **SQL取数 → 数据清洗与统计分析 → 报表生成与可视化 → 报告总结输出** 的全过程，减少人工介入，实现分析自动化与报告标准化。

### 1.2 核心价值

* **效率提升**：自动完成重复性分析任务，缩短从取数到报告输出的周期。
* **标准化**：统一分析逻辑与报告模板，降低人为差异。
* **智能化**：通过多 Agent 协同（Supervisor 模式），根据任务动态决策执行流程。
* **可扩展**：可插拔式的 Agent 体系，支持新增分析模块（如预测、聚类等）。

---

## 2. 系统架构设计

### 2.1 总体架构图

```
┌──────────────────────────────┐
│           Supervisor Agent   │
│  - 任务分解与调度            │
│  - 状态监控与异常处理        │
└──────────────┬───────────────┘
               │
 ┌─────────────┼──────────────────┐
 │             │                  │
 ▼             ▼                  ▼
Data Agent   Analysis Agent     Report Agent
(SQL层)       (Pandas/LLM层)     (NLG/可视化层)
 │             │                  │
 │             │                  │
 ▼             ▼                  ▼
数据库       数据分析模型       报告模板/可视化组件
(MySQL etc.)  (统计/ML模块)     (Markdown/PDF/HTML)
```

---

## 3. 功能设计

### 3.1 Supervisor Agent（任务调度与协作中枢）

**职责：**

* 接收用户输入的任务指令（自然语言或结构化任务描述）；
* 分解任务为可执行子任务；
* 调用相应下游 Agent（Data / Analysis / Report）；
* 监控执行状态与异常恢复；
* 汇总最终结果并返回用户。

**输入示例：**

> “请分析近三个月的销售数据，生成包含销售额趋势、地区分布、前10热销产品的报告。”

**输出示例：**

> 一份 Markdown/PDF 格式的可视化报告，附带关键数据摘要。

---

### 3.2 Data Agent（SQL取数与数据预处理）

**职责：**

* 根据任务需求自动生成 SQL 查询；
* 从数据库（MySQL、PostgreSQL等）中拉取原始数据；
* 进行基础数据清洗（去重、空值处理、类型校正等）；
* 将结果以 DataFrame 格式返回给 Analysis Agent。

**关键功能：**

* SQL模板与自然语言到SQL转换（可结合 Text-to-SQL 模型，如 `sqlcoder` / `gpt-4o-mini`）；
* 数据缓存机制；
* 异常检测（空结果、连接超时等）。

---

### 3.3 Analysis Agent（统计分析与数据洞察）

**职责：**

* 接收 DataFrame；
* 自动识别分析维度（时间、地区、产品等）；
* 根据任务类型选择合适的分析方法（汇总统计、同比环比、聚类、回归等）；
* 生成可解释的分析结论；
* 输出图表数据结构（ECharts / Plotly JSON）。

**关键模块：**

* 通用统计分析模板（销售、库存、用户行为等）；
* 数据可视化（趋势图、饼图、柱状图）；
* 可扩展机器学习模块（预测、聚类分析）。

---

### 3.4 Report Agent（报告生成与自然语言总结）

**职责：**

* 根据分析结果生成标准化报告；
* 通过 LLM 进行文字描述生成（NLG）；
* 生成 Markdown / PDF / HTML 格式文件；
* 可选：推送至邮箱 / Slack / 钉钉。

**输出示例：**

> “本季度整体销售额环比增长12.4%，其中华东地区贡献最大，占比37%。产品B销量增长最快，同比增长54%。”

**附带：**

* 图表自动嵌入；
* 报告模板可配置；
* 审核模式（Supervisor Agent可复核语义合理性）。

---

## 4. 核心流程

### 主流程（自动化执行）

1. 用户输入分析任务；
2. Supervisor 解析任务，规划执行顺序；
3. Data Agent 执行取数；
4. Analysis Agent 进行统计分析；
5. Report Agent 生成报告；
6. Supervisor 汇总结果并返回。

### 异常分支

* 若SQL执行失败 → Data Agent 反馈 → Supervisor 调整SQL；
* 若分析结果异常（空数据）→ Supervisor 通知用户；
* 若报告生成不一致 → Supervisor 请求重新生成。

---

## 5. 技术实现建议

| 模块       | 技术/框架                                |
| -------- | ------------------------------------ |
| Agent 调度 | LangGraph / CrewAI / AutoGen         |
| 数据层      | SQLAlchemy + Pandas                  |
| 可视化      | Matplotlib / Plotly / ECharts        |
| 报告生成     | Markdown + pdfkit / ReportLab        |
| Prompt 层 | Structured Prompt（Task schema + COT） |
| LLM 模型   | GPT-4 / GPT-4o-mini / Qwen2.5-72B    |
| 服务框架     | FastAPI / Streamlit（前端展示）            |
| 存储       | MySQL / PostgreSQL / MinIO (报告文件)    |

---

## 6. 评估与指标

| 模块             | 评估指标   | 示例                   |
| -------------- | ------ | -------------------- |
| Data Agent     | SQL准确率 | 自动SQL查询正确率 ≥ 90%     |
| Analysis Agent | 统计正确性  | 核心指标与人工分析结果一致度 ≥ 95% |
| Report Agent   | 语言质量   | 可读性/流畅性得分 ≥ 4.5/5    |
| 系统整体           | 任务完成率  | 成功自动生成报告占比 ≥ 95%     |

---

## 7. 可扩展方向

* 新增 **异常检测 Agent**（自动发现数据异常并解释原因）；
* 新增 **预测分析 Agent**（基于历史数据的时间序列预测）；
* 支持 **自定义报表模板**；
* 增加 **多模态输入**（图表→文字总结）。


